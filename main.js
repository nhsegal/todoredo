(()=>{"use strict";const e=function(e,t,a,n=null){const o=Math.floor(1e8*Math.random());let d=new Date(e);return d.setHours(0,0,0,0),{date:d,content:t,isCompleted:!1,priority:a,project:n,id:o}},t=(e,t)=>{const a=e.date-t.date;return 0!==a?a:e.priority!==t.priority?"normal"===e.priority?1:-1:e.content.localeCompare(t.content)},a=function(){const e=[],a=()=>{e.sort(t)};return{data:e,displayedList:[],editTask:(t,a,n)=>{for(let o=0;o<e.length;o++)if(e[o].id==t.id)return void(e[o][a]=n);console.log("I couldn't find that task!")},sortByDate:a,produceTasksInAProject:t=>{let a=e.filter((e=>e.project===t));return a},getListOfProjects:()=>{const t=[];return e.forEach((e=>{null==e.project||""===e.project||t.some((t=>t===e.project))||t.push(e.project)})),t},removeTask:t=>{e.splice(e.indexOf(t),1)},addTask:t=>{e.push(t),a()}}}(),n={main:document.querySelector("main"),body:document.querySelector("body"),sideBar:document.querySelector("#sidebar"),todaysTasksSideBar:document.querySelector("#todays-tasks"),thisWeekSideBar:document.querySelector("#this-week"),allTasksSideBar:document.querySelector("#all-tasks"),get addTaskBtn(){return document.querySelector("#add-a-task")},get addTaskForm(){return document.querySelector("#task-form")},get addTaskModal(){return document.querySelector("#add-a-task-modal")},get closeModalButton(){return document.querySelector("#close-modal-button")},get newTaskContent(){return document.querySelector("#task-content")},get newTaskDate(){return document.querySelector("#date")},get newTaskPriority(){return[...document.querySelectorAll("input[name=priority]")]},get newTaskProject(){return document.querySelector("#project")},get cardEditBtns(){return[...document.querySelectorAll(".edit-task")]},get cardRemoveBtns(){return[...document.querySelectorAll(".remove-task")]},get cardCheckBoxs(){return[...document.querySelectorAll('[name="isCompletedCheckbox"]')]},get listByProject(){return document.querySelector("#list-by-project")},get sidebarProjectList(){const e=document.getElementById("list-by-project").children,t=[];for(const a of e)t.push(a.firstChild);return t},get sidebarProjectListRemoveBtns(){const e=document.getElementById("list-by-project").children,t=[];for(const a of e)t.push(a.lastChild);return t}},o={viewBy:"all",whichProject:null,update(e,t=null){this.viewBy=e,this.whichProject=t}};let d=!1,i=null;const s=e=>{d=!0,i=e.target.parentElement.getAttribute("data-id");const t=a.data.filter((e=>e.id==i))[0],o=t.date.getFullYear(),s=t.date.getMonth()+1,c=t.date.getDate();let r=String(1e4*o+100*s+c);r=`${r.slice(0,4)}-${r.slice(4,6)}-${r.slice(6,8)}`,n.newTaskContent.value=t.content,n.newTaskDate.value=r,n.newTaskProject.value=t.project;for(const e of n.newTaskPriority)e.value===t.priority&&(e.checked=!0);n.addTaskModal.classList.toggle("closed")},c=e=>{i=e.target.parentElement.getAttribute("data-id");const t=a.data.filter((e=>e.id==i))[0];a.removeTask(t),localStorage.setItem("oldData",JSON.stringify(a.data)),a.displayedList.splice(a.displayedList.indexOf(t),1),localStorage.setItem("oldDisplayList",JSON.stringify(a.displayedList)),g(a,o.viewBy,o.whichProject),m()},r=function(e){i=e.target.getAttribute("data-id");const t=a.data.filter((e=>e.id==i))[0];this.checked?(t.isCompleted=!0,e.target.parentElement.classList.add("is-completed"),a.editTask(t,"isCompleted",!0)):(t.isCompleted=!1,e.target.parentElement.classList.remove("is-completed"))};function l(e){document.querySelector(`[data-id="${e.id}"] input`).addEventListener("change",r),document.querySelectorAll(`[data-id="${e.id}"] button`)[0].addEventListener("click",s),document.querySelectorAll(`[data-id="${e.id}"] button`)[1].addEventListener("click",c)}function u(e){document.querySelector(`[data-id="${e.id}"] input`).removeEventListener("change",r),document.querySelectorAll(`[data-id="${e.id}"] button`)[0].removeEventListener("click",s),document.querySelectorAll(`[data-id="${e.id}"] button`)[1].removeEventListener("click",c)}function m(){for(const e of a.displayedList)l(e)}function p(){try{n.todaysTasksSideBar.addEventListener("click",(()=>{o.update("today",null),g(a,o.viewBy,o.whichProject),m()})),n.thisWeekSideBar.addEventListener("click",(()=>{o.update("this-week",null),g(a,o.viewBy,o.whichProject),m()})),n.allTasksSideBar.addEventListener("click",(()=>{o.update("all",null),g(a,o.viewBy,o.whichProject),m()}))}catch{console.log("failed to add today/week/all ELs")}}function h(){const e=function(e){confirm("Delete this project and all tasks in it?")?(a.produceTasksInAProject(e.target.previousElementSibling.id).forEach((e=>a.removeTask(e))),localStorage.setItem("oldData",JSON.stringify(a.data)),localStorage.setItem("oldDisplayList",JSON.stringify(a.displayedList)),g(a,n.main,o.viewBy,o.whichProject),v(a.getListOfProjects()),h(),m()):console.log("You pressed Cancel!")};try{for(const e of n.sidebarProjectList){const t=e;t.addEventListener("click",(()=>{o.update("byProject",t.id),g(a,o.viewBy,o.whichProject),m()}))}for(const t of n.sidebarProjectListRemoveBtns){const n=t;n.addEventListener("click",(t=>{"byProject"===o.viewBy&&o.whichProject===n.previousElementSibling.id&&o.update("all"),e(t),g(a,o.viewBy,o.whichProject),m(),v(a.getListOfProjects()),h()}))}}catch{console.log("failed to add ELs to projects")}}function y(){n.addTaskBtn.addEventListener("click",(()=>{d=!1,n.addTaskModal.classList.toggle("closed")})),n.closeModalButton.addEventListener("click",(()=>{n.addTaskModal.classList.toggle("closed"),n.newTaskContent.value=null,n.newTaskDate.value=null;for(const e of n.newTaskPriority)e.checked=!1;n.newTaskProject.value=null})),n.addTaskForm.addEventListener("submit",(function(t){if(t.preventDefault(),n.addTaskModal.classList.toggle("closed"),d){const e=a.data.filter((e=>e.id==i))[0];a.editTask(e,"content",n.newTaskContent.value);let t=new Date(n.newTaskDate.value);t.setHours(0,0,0,0),a.editTask(e,"date",t);const o=Array.from(n.newTaskPriority).filter((e=>e.checked))[0];a.editTask(e,"priority",o.value),a.editTask(e,"project",n.newTaskProject.value),a.sortByDate(),localStorage.setItem("oldData",JSON.stringify(a.data)),localStorage.setItem("oldDisplayList",JSON.stringify(a.displayedList))}else{let t=null;n.newTaskPriority.forEach((e=>{e.checked&&(t=e.value)}));const o=e(n.newTaskDate.value,n.newTaskContent.value,t,n.newTaskProject.value);a.addTask(o),a.sortByDate(),localStorage.setItem("oldData",JSON.stringify(a.data)),localStorage.setItem("oldDisplayList",JSON.stringify(a.displayedList))}n.newTaskContent.value=null,n.newTaskDate.value=null;for(const e of n.newTaskPriority)e.checked=!1;n.newTaskProject.value=null,g(a,n.main,o.viewBy,o.whichProject),v(a.getListOfProjects()),h(),p(),m(),a.sortByDate()}));try{n.todaysTasksSideBar.addEventListener("click",(()=>{o.update("today",null),g(a,o.viewBy,o.whichProject),m()})),n.thisWeekSideBar.addEventListener("click",(()=>{o.update("this-week",null),g(a,o.viewBy,o.whichProject),m()})),n.allTasksSideBar.addEventListener("click",(()=>{o.update("all",null),g(a,o.viewBy,o.whichProject),m()}))}catch{console.log("failed to add event listeners")}}function k(e){const t=document.createElement("input");t.type="checkbox",t.name="isCompletedCheckbox",t.setAttribute("data-id",e.id),t.checked=e.isCompleted,t.id=e.content;const a=document.createElement("div");a.classList.add("task-name"),a.setAttribute("data-id",e.id),a.textContent=e.content;const n=document.createElement("div");n.classList.add("task-due-date"),n.setAttribute("data-id",e.id),n.textContent=`Due: ${e.date.toLocaleString("default",{weekday:"short"})},\n        ${e.date.toLocaleString("default",{month:"short"})}. \n        ${e.date.getDate()} `;const o=document.createElement("button");o.classList.add("edit-task"),o.classList.add("material-icons"),o.setAttribute("data-id",e.id),o.textContent="edit";const d=document.createElement("button");d.classList.add("remove-task"),d.classList.add("material-icons"),d.setAttribute("data-id",e.id),d.textContent="delete";const i=document.createElement("div");return i.classList.add("card"),i.setAttribute("data-id",e.id),"high"===e.priority&&i.classList.add("important"),i.append(t,a,n,o,d),t.checked?t.parentElement.classList.add("is-completed"):t.parentElement.classList.contains("is-completed")&&t.parentElement.classList.remove("is-completed"),i}function g(e,t,a=null){const o=new Date;o.setHours(0,0,0,0);const d=new Date(o);d.setDate(d.getDate()+1);const i=new Date(o);i.setDate(o.getDate()+7);let s=null,c=null,r=null;for(const t of e.displayedList)u(t);for(;n.main.firstChild;)n.main.removeChild(n.main.firstChild),e.displayedList.splice(0,e.displayedList.length);if("byProject"===t){const t=e.produceTasksInAProject(a),d=document.createElement("div");d.classList.add("heading"),d.textContent=a,n.main.append(d);for(let a=0;a<t.length;a++){if(t[a].date>=o&&t[a].date<=o&&null==s){s=1;const e=document.createElement("div");e.classList.add("subheading"),e.textContent="Today",n.main.append(e)}if(t[a].date>o&&1===s){s=null;const e=document.createElement("hr");n.main.append(e)}n.main.append(k(t[a])),e.displayedList.push(t[a])}}else for(let a=0;a<e.data.length;a++){if(e.data[a].date>=d&&"today"===t)return;if(e.data[a].date>i&&"this-week"===t)return;if(e.data[a].date<o&&null==c&&!1===e.data[a].isCompleted){c=1;const e=document.createElement("div");e.classList.add("heading"),e.textContent="Past Due",n.main.append(e)}if(e.data[a].date>=o&&1===c){c=2;const e=document.createElement("hr");n.main.append(e)}if(e.data[a].date>=o&&e.data[a].date<d&&null==s){s=1;const e=document.createElement("div");e.classList.add("heading"),e.textContent="Today",n.main.append(e)}if(e.data[a].date>=d&&1==s){s=2;const e=document.createElement("hr");n.main.append(e)}if(e.data[a].date<=i&&e.data[a].date>=d&&null==r){r=1;const e=document.createElement("div");e.classList.add("heading"),e.textContent="This Week",n.main.append(e)}if(e.data[a].date>i&&1===r){r=2;const e=document.createElement("hr");n.main.append(e)}(!1===e.data[a].isCompleted&&e.data[a].date<o||e.data[a].date>=o)&&(n.main.append(k(e.data[a])),e.displayedList.push(e.data[a]))}}function f(e,t){const a=document.createElement("div");a.classList.add("modal"),a.classList.add("closed"),a.id="add-a-task-modal";const n=document.createElement("div");n.classList.add("modal-content");const o=document.createElement("form");o.id="task-form";const d=document.createElement("div");d.textContent=" ";const i=document.createElement("div");i.textContent=" ";const s=document.createElement("div");s.id="close-modal-button",s.innerHTML="&times";const c=document.createElement("div");c.textContent=" ";const r=document.createElement("label");r.for="task-content",r.textContent="Task:";const l=document.createElement("input");l.type="text",l.id="task-content",l.name="task-content",l.placeholder="Enter Task",l.required=!0;const u=document.createElement("div");u.textContent=" ";const m=document.createElement("label");m.for="date",m.textContent="Due:";const p=document.createElement("div");p.textContent=" ";const h=document.createElement("input");h.type="date",h.id="date",h.name="date",h.required=!0;const y=document.createElement("div");y.textContent=" ";const k=document.createElement("div");k.textContent="Priority:";const g=document.createElement("div");g.id="priority-options";const f=document.createElement("div"),v=document.createElement("input");v.type="radio",v.id="normal",v.name="priority",v.value="normal",v.required=!0;const E=document.createElement("label");E.for="normal",E.textContent="Normal";const L=document.createElement("div"),j=document.createElement("input");j.type="radio",j.id="high",j.name="priority",j.value="high",j.required=!0;const w=document.createElement("label");w.for="high",w.textContent="High";const S=document.createElement("label");S.for="project",S.textContent="Project:";const T=document.createElement("input");T.name="project",T.id="project",T.placeholder="Optional",T.setAttribute("list","project-list");const C=document.createElement("datalist");C.id="project-list";for(let e=0;e<t.length;e++){const a=document.createElement("option");a.value=t[e],a.textContent=t[e],C.append(a)}T.append(C);const b=document.createElement("button");b.type="submit",b.id="modal-submit",b.value="Submit",b.textContent="Submit",f.append(v,E),L.append(j,w),g.append(f,L),o.append(d,i,s,r,l,c,m,h,u,k,g,p,S,T,y,b),n.append(o),a.append(n),e.append(a)}function v(e){for(;n.sidebarProjectList.length;)n.listByProject.removeChild(n.listByProject.lastChild);e&&e.forEach((e=>{!function(e){const t=document.createElement("li"),a=document.createElement("a");a.id=e,a.href="#",a.textContent=e;const o=document.createElement("a");o.id=`${e}Remove`,o.href="#",o.classList.add("material-icons"),o.textContent="delete",t.append(a,o),n.listByProject.append(t)}(e)}))}localStorage.getItem("oldData")?(function(t){const n=JSON.parse(t);for(let t=0;t<n.length;t++){const o=e(n[t].date,n[t].content,n[t].priority);o.project=n[t].project,o.completed=n[t].completed,a.data.push(o)}}(localStorage.getItem("oldData")),g(a,o.viewBy,o.whichProject),v(a.getListOfProjects()),f(n.body,a.getListOfProjects()),y(),m(),p(),h()):(function(){const t=new Date;t.setHours(0,0,0,0);const o=new Date(t);o.setDate(t.getDate()-1);const d=new Date(t);d.setDate(t.getDate()+1),new Date(t).setDate(t.getDate()+2);const i=new Date(t);i.setDate(t.getDate()+8);const s=e(t,"Refactor tic-tac-toe program","normal"),c=e(t,"Buy milk","high"),r=e(d,"Buy birthday card","normal"),l=e(d,"Call mom","high"),u=e(d,"Do Ruby beginner tutorial","normal"),k=e(o,"Vacuum","high"),E=e(i,"Paint the shed","high");a.data.push(s),a.data.push(c),a.data.push(r),a.data.push(l),a.data.push(u),a.data.push(k),a.data.push(E),a.editTask(s,"project","Coding"),a.editTask(c,"project","Shopping"),a.editTask(r,"project","Shopping"),a.editTask(u,"project","Coding"),a.editTask(k,"project","Housework"),a.editTask(E,"project","Housework"),a.sortByDate(),g(a,"today",null),f(n.body,a.getListOfProjects()),v(a.getListOfProjects()),y(),m(),p(),h()}(),localStorage.setItem("instance",a),localStorage.setItem("oldData",JSON.stringify(a.data)),localStorage.setItem("oldDisplayList",JSON.stringify(a.displayedList)))})();